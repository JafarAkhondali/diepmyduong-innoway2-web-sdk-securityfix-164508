<!DOCTYPE html>
<html>
  <head>
    <title>Foo</title>
  </head>
  <body>
    <h1>Innoway 2</h1>
    <h1>Brand ID: <span id="brand_id"></span></h1>
    <button id="verify_button">Login</button>
    <div id="customer" style="display:none">
      <h1>Customer ID : <span id="customer_id"></span></h1>
      <button id="logout_button">Logout</button>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
    <script src="dist/innoway2.min.js"></script>
    <script>
      innoway2.init({
        // host: 'http://localhost:3000/',
        host: 'https://innoway2.herokuapp.com/',
        brand_id: '3791cbd0-8eeb-11e7-9619-576bbea02309'
      });

      $button = $('#verify_button');
      $brand_id = $('#brand_id');
      $customer = $('#customer');
      $customer_id = $('#customer_id');
      $logout_button = $('#logout_button');
      
      $brand_id.html(innoway2.config.get('brand_id'));
      var customerSerivce = innoway2.api.module('customer');

      $logout_button.on('click',()=>{
        customerSerivce.logout().then(()=>{
          $button.show();
          $customer.hide();
          $customer_id.html("");
          AkitLogin();
        })
      });

      $(customerSerivce).on('on_auth_change',(e,state)=>{
        console.log("ON STATE CHANGE",state);
        if(state){
          $button.hide();
          $customer.show();
          console.log("ID",customerSerivce);
          $customer_id.html(customerSerivce.info.id);
        }else{
          innoway2.api.isReady().then(()=>{  
            AkitLogin();
          });
        }
      })

      function AkitLogin(){
        customerSerivce.AKitInit().then(()=>{
          $button = $('#verify_button');
          $button.on('click',()=>{
            customerSerivce.AKitLogin("+84","").then(user =>{
                console.log("User",user);
            });
          });
        });
      }


      
      // //Test Product
      var productService = innoway2.api.module('product');
      $(productService).on('on_change',(e,data) =>{
        console.log('products',data.items);
      })
      // var toppingService = innoway2.api.module('topping');
      // var toppingValueService = innoway2.api.module('topping_value');

      // var product_id = "ff080d20-886d-11e7-abff-570d77df0e87";
      // productService.getToppings(product_id).then(toppings =>{
      //   console.log('TOPPINGS',toppings);
      //   toppings.forEach(t =>{
      //     toppingService.getValues(t.id).then(values =>{
      //       console.log('TOPPING VALUES',values);
      //     });
      //   })
      // })

      // //Test Basket
      // var basketService = innoway2.api.module('basket');
      // basketService.clear();
      // var pro_1 = {
      //   id: "1",

      //   toppings: [
      //     "topping_1",
      //     "topping_2"
      //   ],
      //   amount: 1
      // }
      // var pro_2 = {
      //   id: "2",
      //   toppings: [
      //     "topping_1",
      //     "topping_2"
      //   ],
      //   amount: 1
      // }
      // var pro_3 = {
      //   id: "1",
      //   toppings: [
      //     "topping_1"
      //   ],
      //   amount: 1
      // }
      // basketService.add(pro_1);
      // basketService.add(pro_2);
      // basketService.add(pro_3);
      // console.log(basketService.getAll());

      // function getCurrentLocation(){
      //   return new Promise((resolve,reject)=>{
      //       navigator.geolocation.getCurrentPosition(function(position) { 
      //           resolve(position.coords);
      //       },(failure) => {
      //           $.getJSON('https://ipinfo.io/geo', function(response) { 
      //               var loc = response.loc.split(',');
      //               var coords = {
      //                   latitude: parseFloat(loc[0]),
      //                   longitude: parseFloat(loc[1])
      //               };
      //               resolve(coords);
      //           }); 
      //       });
      //   })
      // }
      // getCurrentLocation().then(p =>{
      //   console.log('localtion',p);
      //   var data = {
      //     latitude: p.latitude,
      //     longitude: p.longitude
      //   }
      //   basketService.checkout(data)
      // })
      
    </script>
</html>